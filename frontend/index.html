<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚öΩ Football Betting - Predictions</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: Arial, sans-serif;
      background: #000;
      color: #fff;
      line-height: 1.6;
    }
    
    .navbar {
      background: #1a1a1a;
      padding: 20px;
      border-bottom: 2px solid #c87b2f;
      display: flex;
      gap: 40px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .navbar button {
      background: none;
      border: none;
      color: #fff;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      padding: 10px 20px;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }
    
    .navbar button:hover,
    .navbar button.active {
      color: #c87b2f;
      border-bottom-color: #c87b2f;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }
    
    h1, h2 { margin: 20px 0; font-size: 32px; color: #c87b2f; }
    h2 { font-size: 24px; }
    
    .section { display: none; }
    .section.active { display: block; }
    
    .events-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .event-card {
      background: #1a1a1a;
      border: 1px solid #444;
      padding: 20px;
      border-radius: 8px;
      transition: all 0.3s;
    }
    
    .event-card:hover {
      border-color: #c87b2f;
      box-shadow: 0 0 15px rgba(200, 123, 47, 0.3);
    }
    
    .teams {
      font-size: 18px;
      font-weight: bold;
      margin: 15px 0;
      text-align: center;
    }
    
    .odds {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin: 15px 0;
    }
    
    .odds-btn {
      background: #c87b2f;
      color: #000;
      border: none;
      padding: 10px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 4px;
      transition: all 0.3s;
      font-size: 12px;
    }
    
    .odds-btn:hover {
      background: #f0b981;
      transform: scale(1.05);
    }
    
    .status {
      display: inline-block;
      background: #444;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
    }
    
    .prediction-card {
      background: #1a1a1a;
      border: 2px solid #c87b2f;
      padding: 20px;
      border-radius: 8px;
      margin: 15px 0;
    }
    
    .prediction-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .prediction-item {
      background: #0a0a0a;
      border: 1px solid #c87b2f;
      padding: 15px;
      border-radius: 6px;
      text-align: center;
    }
    
    .prediction-prob {
      font-size: 24px;
      color: #f0b981;
      font-weight: bold;
      margin: 10px 0;
    }
    
    .prediction-label {
      color: #aaa;
      font-size: 14px;
    }
    
    .bets-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    .bets-table th,
    .bets-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #444;
    }
    
    .bets-table th {
      background: #1a1a1a;
      color: #c87b2f;
      font-weight: bold;
    }
    
    .bets-table tr:hover {
      background: #1a1a1a;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      color: #aaa;
    }
    
    .error {
      background: #8b0000;
      padding: 15px;
      border-radius: 4px;
      margin: 20px 0;
    }
    
    .success {
      background: #006400;
      padding: 15px;
      border-radius: 4px;
      margin: 20px 0;
    }
    
    .btn {
      background: #c87b2f;
      color: #000;
      border: none;
      padding: 12px 25px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 4px;
      transition: all 0.3s;
      margin: 10px 5px;
    }
    
    .btn:hover {
      background: #f0b981;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <button class="nav-btn active" onclick="switchSection('matches')">Matchs</button>
    <button class="nav-btn" onclick="switchSection('predictions')">Pr√©dictions</button>
    <button class="nav-btn" onclick="switchSection('bets')">Mes Paris</button>
  </div>

  <div class="container">
    <!-- Section Matchs -->
    <div id="matches" class="section active">
      <h1>Matchs Disponibles</h1>
      <div id="events-container" class="loading">Chargement...</div>
    </div>

    <!-- Section Pr√©dictions -->
    <div id="predictions" class="section">
      <h1>Pr√©dictions Bay√©siennes</h1>
      <p style="color: #aaa; margin: 20px 0;">Les pr√©dictions sont bas√©es sur un mod√®le hi√©rarchique Poisson qui analyse la force offensive/d√©fensive de chaque √©quipe.</p>
      
      <div style="background: #1a1a1a; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <h3>S√©lectionner un Match</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 15px;">
          <div>
            <label style="color: #aaa;">√âquipe 1:</label>
            <select id="team1-select" style="width: 100%; padding: 8px; margin-top: 5px; background: #0a0a0a; border: 1px solid #444; color: #fff; border-radius: 4px;">
              <option>-- S√©lectionner --</option>
            </select>
          </div>
          <div>
            <label style="color: #aaa;">√âquipe 2:</label>
            <select id="team2-select" style="width: 100%; padding: 8px; margin-top: 5px; background: #0a0a0a; border: 1px solid #444; color: #fff; border-radius: 4px;">
              <option>-- S√©lectionner --</option>
            </select>
          </div>
          <div style="display: flex; align-items: flex-end;">
            <button class="btn" onclick="predictMatch()" style="width: 100%;">Pr√©dire</button>
          </div>
        </div>
      </div>
      
      <div id="prediction-result"></div>
      
      <h2 style="margin-top: 40px;">Stats par √âquipe</h2>
      <div id="team-stats-container" class="loading">Chargement...</div>
    </div>

    <!-- Section Mes Paris -->
    <div id="bets" class="section">
      <h2>Mes Paris</h2>
      <div id="bets-container" class="loading">Chargement...</div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:8000/api';
    let allTeams = [];

    function switchSection(sectionId) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      
      document.getElementById(sectionId).classList.add('active');
      event.target.classList.add('active');
      
      if (sectionId === 'bets') loadBets();
      if (sectionId === 'matches') loadEvents();
      if (sectionId === 'predictions') {
        loadTeamStats();
        loadTeamsForSelect();
      }
    }

    async function loadEvents() {
      const container = document.getElementById('events-container');
      container.innerHTML = '<div class="loading">Chargement...</div>';
      
      try {
        const res = await fetch(`${API_URL}/events`);
        const data = await res.json();
        const events = Array.isArray(data) ? data : (data.events || []);
        
        container.innerHTML = `<div class="events-grid">
          ${events.map(event => `
            <div class="event-card">
              <div class="status">${event.status}</div>
              <div class="teams">${event.team1} vs ${event.team2}</div>
              <div style="font-size: 12px; color: #aaa;">
                ${new Date(event.date).toLocaleDateString('fr-FR')}
              </div>
              <div class="odds">
                <button class="odds-btn" onclick="placeBet(${event.id}, 'team1', ${event.odds_team1})">
                  ${event.team1}<br>${event.odds_team1.toFixed(2)}
                </button>
                <button class="odds-btn" onclick="placeBet(${event.id}, 'draw', ${event.odds_draw})">
                  Nul<br>${event.odds_draw.toFixed(2)}
                </button>
                <button class="odds-btn" onclick="placeBet(${event.id}, 'team2', ${event.odds_team2})">
                  ${event.team2}<br>${event.odds_team2.toFixed(2)}
                </button>
              </div>
            </div>
          `).join('')}
        </div>`;
        
        // Collecter les √©quipes
        allTeams = [...new Set(events.flatMap(e => [e.team1, e.team2]))].sort();
      } catch (error) {
        container.innerHTML = `<div class="error">Erreur: ${error.message}</div>`;
      }
    }

    async function loadTeamsForSelect() {
      try {
        const res = await fetch(`${API_URL}/events`);
        const data = await res.json();
        const events = Array.isArray(data) ? data : (data.events || []);
        allTeams = [...new Set(events.flatMap(e => [e.team1, e.team2]))].sort();
        
        const select1 = document.getElementById('team1-select');
        const select2 = document.getElementById('team2-select');
        
        allTeams.forEach(team => {
          select1.innerHTML += `<option>${team}</option>`;
          select2.innerHTML += `<option>${team}</option>`;
        });
      } catch (error) {
        console.error('Error loading teams:', error);
      }
    }

    async function predictMatch() {
      const team1 = document.getElementById('team1-select').value;
      const team2 = document.getElementById('team2-select').value;
      
      if (team1 === '-- S√©lectionner --' || team2 === '-- S√©lectionner --') {
        alert('S√©lectionner deux √©quipes');
        return;
      }
      
      const resultDiv = document.getElementById('prediction-result');
      resultDiv.innerHTML = '<div class="loading">Pr√©diction en cours...</div>';
      
      try {
        const res = await fetch(`${API_URL}/predict-match?team1=${team1}&team2=${team2}`);
        const prediction = await res.json();
        
        if (prediction.error) {
          resultDiv.innerHTML = `<div class="error">${prediction.error}</div>`;
          return;
        }
        
        resultDiv.innerHTML = `
          <div class="prediction-card">
            <h2>${prediction.team1} vs ${prediction.team2}</h2>
            <div class="prediction-grid">
              <div class="prediction-item">
                <div class="prediction-label">Victoire ${prediction.team1}</div>
                <div class="prediction-prob">${(prediction.home_win_prob * 100).toFixed(1)}%</div>
              </div>
              <div class="prediction-item">
                <div class="prediction-label">Match Nul</div>
                <div class="prediction-prob">${(prediction.draw_prob * 100).toFixed(1)}%</div>
              </div>
              <div class="prediction-item">
                <div class="prediction-label">Victoire ${prediction.team2}</div>
                <div class="prediction-prob">${(prediction.away_win_prob * 100).toFixed(1)}%</div>
              </div>
            </div>
            <div style="margin-top: 20px; text-align: center;">
              <p>Buts attendus: <span style="color: #f0b981; font-weight: bold;">${prediction.expected_home_goals.toFixed(2)}</span> - <span style="color: #f0b981; font-weight: bold;">${prediction.expected_away_goals.toFixed(2)}</span></p>
              <p style="color: #aaa; font-size: 14px;">Confiance: ${prediction.confidence}</p>
            </div>
          </div>
        `;
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">Erreur: ${error.message}</div>`;
      }
    }

    async function loadTeamStats() {
      const container = document.getElementById('team-stats-container');
      container.innerHTML = '<div class="loading">Chargement...</div>';
      
      try {
        const res = await fetch(`${API_URL}/team-stats`);
        const stats = await res.json();
        
        if (Object.keys(stats).length === 0) {
          container.innerHTML = '<p style="color: #aaa;">Mod√®le en entra√Ænement...</p>';
          return;
        }
        
        const html = Object.entries(stats)
          .sort((a, b) => b[1].strength - a[1].strength)
          .map(([team, stat]) => `
            <div class="event-card" style="margin: 10px 0;">
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                <div>
                  <div style="color: #aaa; font-size: 12px;">√âQUIPE</div>
                  <div style="font-size: 20px; font-weight: bold;">${team}</div>
                </div>
                <div>
                  <div style="color: #aaa; font-size: 12px;">ATTAQUE</div>
                  <div style="font-size: 20px; color: #f0b981; font-weight: bold;">${stat.attack.toFixed(2)}</div>
                </div>
                <div>
                  <div style="color: #aaa; font-size: 12px;">D√âFENSE</div>
                  <div style="font-size: 20px; color: #f0b981; font-weight: bold;">${stat.defense.toFixed(2)}</div>
                </div>
              </div>
              <div style="background: #0a0a0a; padding: 10px; margin-top: 10px; border-radius: 4px; text-align: center;">
                <span style="color: #aaa;">Force: </span><span style="color: #c87b2f; font-weight: bold;">${stat.strength.toFixed(2)}</span>
              </div>
            </div>
          `).join('');
        
        container.innerHTML = html;
      } catch (error) {
        container.innerHTML = `<div class="error">Erreur: ${error.message}</div>`;
      }
    }

    async function loadBets() {
      const container = document.getElementById('bets-container');
      container.innerHTML = '<div class="loading">Chargement...</div>';
      
      try {
        const res = await fetch(`${API_URL}/my-bets`);
        const data = await res.json();
        const bets = Array.isArray(data) ? data : (data.bets || []);
        
        if (!bets.length) {
          container.innerHTML = '<p>Aucun pari encore.</p>';
          return;
        }
        
        container.innerHTML = `
          <table class="bets-table">
            <thead>
              <tr>
                <th>Type</th>
                <th>Montant</th>
                <th>C√¥te</th>
                <th>Statut</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              ${bets.map(bet => `
                <tr>
                  <td>${bet.bet_type}</td>
                  <td>${bet.amount}‚Ç¨</td>
                  <td>${bet.odds.toFixed(2)}</td>
                  <td>${bet.status}</td>
                  <td>${new Date(bet.created_at).toLocaleDateString('fr-FR')}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      } catch (error) {
        container.innerHTML = `<div class="error">Erreur: ${error.message}</div>`;
      }
    }

    async function placeBet(eventId, betType, odds) {
      const amount = prompt('Montant du pari (‚Ç¨):');
      if (!amount || isNaN(amount) || amount < 1) return;
      
      try {
        const res = await fetch(`${API_URL}/bets`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            event_id: eventId,
            user_id: 1,
            bet_type: betType,
            amount: parseFloat(amount),
            odds: odds
          })
        });
        
        if (res.ok) {
          alert('Pari plac√©! üéâ');
          loadEvents();
        } else {
          alert('Erreur: ' + (await res.text()));
        }
      } catch (error) {
        alert('Erreur: ' + error.message);
      }
    }

    loadEvents();
  </script>
</body>
</html>
